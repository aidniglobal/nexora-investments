<!-- Residency Program Detail Template -->
{% extends "base.html" %}

{% block title %}{{ program.program_name }} - Nexora Investments{% endblock %}

{% block content %}
<div class="program-detail-container" style="margin-top: 80px; padding-bottom: 60px;">
    <!-- Header Section -->
    <div class="program-header" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(236, 72, 153, 0.1)); backdrop-filter: blur(10px); padding: 50px 20px; margin-bottom: 40px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.15);">
        <div class="container" style="max-width: 1200px; margin: 0 auto;">
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                {% if program.country_flag_code %}
                <img src="https://cdn.jsdelivr.net/npm/flag-icons@6.11.0/flags/4x3/{{ program.country_flag_code | lower }}.svg" 
                     alt="{{ program.country }}" 
                     style="width: 60px; height: 45px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);">
                {% endif %}
                <div>
                    <p style="color: #8b5cf6; font-weight: 600; margin-bottom: 5px;">{{ program.country }}</p>
                    <h1 style="font-size: 2.2rem; font-weight: 700; color: #f0f9ff; margin: 0;">
                        {{ program.program_name }}
                    </h1>
                </div>
            </div>
            
            {% if program.program_type %}
            <div style="display: flex; gap: 10px;">
                <span style="background: linear-gradient(135deg, #8b5cf6, #ec4899); color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 0.9rem;">
                    {{ program.program_type | capitalize }}
                </span>
                {% if program.interview_required %}
                <span style="background: rgba(255, 193, 7, 0.2); color: #fcd34d; padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 0.9rem;">
                    Interview Required
                </span>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
        <!-- Main Content Grid -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
            <!-- Left Column -->
            <div>
                <!-- Description -->
                {% if program.description %}
                <div class="info-card" style="background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.15); margin-bottom: 25px;">
                    <h3 style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; font-weight: 600;">üìã Overview</h3>
                    <p style="color: #cbd5e1; line-height: 1.6;">{{ program.description }}</p>
                </div>
                {% endif %}

                <!-- Benefits -->
                {% if program.benefits %}
                <div class="info-card" style="background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.15); margin-bottom: 25px;">
                    <h3 style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; font-weight: 600;">‚ú® Benefits</h3>
                    <p style="color: #cbd5e1; line-height: 1.8;">{{ program.benefits }}</p>
                </div>
                {% endif %}

                <!-- Documents Required -->
                {% if program.documents_required %}
                <div class="info-card" style="background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.15); margin-bottom: 25px;">
                    <h3 style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; font-weight: 600;">üìÑ Documents Required</h3>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        {% for doc in program.documents_required %}
                        <li style="color: #cbd5e1; padding: 8px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; align-items: center;">
                            <span style="color: #8b5cf6; margin-right: 12px; font-size: 1.2rem;">‚úì</span>
                            {{ doc }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>

            <!-- Right Column -->
            <div>
                <!-- Investment Details -->
                <div class="info-card" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(236, 72, 153, 0.1)); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.15); margin-bottom: 25px;">
                    <h3 style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 20px; font-weight: 600;">üí∞ Investment Details</h3>
                    
                    {% if program.investment_required %}
                    <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <p style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 5px;">Amount Required</p>
                        <p style="color: #f0f9ff; font-size: 1.4rem; font-weight: 700;">{{ program.investment_required }}</p>
                    </div>
                    {% endif %}

                    {% if program.investment_currency and program.investment_min_amount %}
                    <div style="background: rgba(139, 92, 246, 0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <p style="color: #cbd5e1; font-size: 0.85rem; margin-bottom: 5px;">Minimum Investment</p>
                        <p style="color: #f0f9ff; font-size: 1.3rem; font-weight: 700;">
                            {{ program.investment_currency }} {{ "{:,.0f}".format(program.investment_min_amount) }}
                        </p>
                        <button class="currency-converter" data-amount="{{ program.investment_min_amount }}" data-currency="{{ program.investment_currency }}" style="margin-top: 10px; padding: 8px 12px; background: rgba(139, 92, 246, 0.3); color: #8b5cf6; border: 1px solid #8b5cf6; border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-weight: 600;">
                            Convert Currency
                        </button>
                    </div>
                    {% endif %}

                    {% if program.net_worth_required %}
                    <div style="background: rgba(139, 92, 246, 0.2); padding: 15px; border-radius: 10px;">
                        <p style="color: #cbd5e1; font-size: 0.85rem; margin-bottom: 5px;">Required Net Worth</p>
                        <p style="color: #f0f9ff; font-size: 1.3rem; font-weight: 700;">
                            $ {{ "{:,.0f}".format(program.net_worth_required) }}
                        </p>
                    </div>
                    {% endif %}
                </div>

                <!-- Timeline & Requirements -->
                <div class="info-card" style="background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.15); margin-bottom: 25px;">
                    <h3 style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 20px; font-weight: 600;">‚è±Ô∏è Timeline & Requirements</h3>

                    {% if program.processing_time %}
                    <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <p style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 5px;">Processing Time</p>
                        <p style="color: #f0f9ff; font-size: 1.2rem; font-weight: 700;">{{ program.processing_time }}</p>
                    </div>
                    {% endif %}

                    {% if program.family_size_limit %}
                    <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <p style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 5px;">Family Size Limit</p>
                        <p style="color: #f0f9ff; font-size: 1.2rem; font-weight: 700;">{{ program.family_size_limit }} members</p>
                    </div>
                    {% endif %}

                    {% if program.age_requirement %}
                    <div>
                        <p style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 5px;">Age Requirement</p>
                        <p style="color: #f0f9ff; font-size: 1.2rem; font-weight: 700;">{{ program.age_requirement }}</p>
                    </div>
                    {% endif %}
                </div>

                <!-- Embassy Locations -->
                {% if program.embassy_locations %}
                <div class="info-card" style="background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.15); margin-bottom: 25px;">
                    <h3 style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; font-weight: 600;">üèõÔ∏è Embassy Locations</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        {% for location in program.embassy_locations %}
                        <span style="background: rgba(139, 92, 246, 0.2); color: #cbd5e1; padding: 8px 12px; border-radius: 8px; font-size: 0.9rem;">
                            üìç {{ location }}
                        </span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- CTA Button -->
                <a href="{{ url_for('residencies.eligibility_checker_view') }}" style="display: block; width: 100%; text-align: center; background: linear-gradient(135deg, #8b5cf6, #ec4899); color: white; padding: 15px 20px; border-radius: 12px; font-weight: 700; text-decoration: none; transition: all 0.3s ease; font-size: 1rem;">
                    Check Your Eligibility
                </a>
            </div>
        </div>

        <!-- Similar Programs -->
        {% if similar_programs %}
        <div class="similar-programs" style="margin-bottom: 40px;">
            <h3 style="color: #e2e8f0; font-size: 1.5rem; font-weight: 700; margin-bottom: 25px;">Similar Programs</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                {% for prog in similar_programs %}
                <a href="{{ url_for('residencies.program_detail', program_id=prog.id) }}" 
                   style="text-decoration: none; background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.15); transition: all 0.3s ease; display: block;">
                    <h4 style="color: #f0f9ff; margin-bottom: 10px; font-weight: 600;">{{ prog.program_name }}</h4>
                    <p style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 12px;">{{ prog.investment_required }}</p>
                    <span style="color: #8b5cf6; font-weight: 600; font-size: 0.9rem;">View ‚Üí</span>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Currency Converter Modal -->
<div id="currencyModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 20px; padding: 30px; max-width: 400px; width: 90%;">
        <h2 style="color: #f0f9ff; margin-bottom: 20px; font-weight: 700;">Currency Converter</h2>
        
        <div style="margin-bottom: 20px;">
            <label style="color: #cbd5e1; display: block; margin-bottom: 8px; font-size: 0.9rem;">From</label>
            <select id="fromCurrency" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(139, 92, 246, 0.3); background: rgba(15, 23, 42, 0.8); color: #e2e8f0;">
                <option>USD</option>
                <option>EUR</option>
                <option>GBP</option>
                <option>CAD</option>
                <option>AUD</option>
                <option>SGD</option>
                <option>AED</option>
                <option>CHF</option>
            </select>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="color: #cbd5e1; display: block; margin-bottom: 8px; font-size: 0.9rem;">To</label>
            <select id="toCurrency" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(139, 92, 246, 0.3); background: rgba(15, 23, 42, 0.8); color: #e2e8f0;">
                <option>EUR</option>
                <option>USD</option>
                <option>GBP</option>
                <option>CAD</option>
                <option>AUD</option>
                <option>SGD</option>
                <option>AED</option>
                <option>CHF</option>
            </select>
        </div>

        <div id="conversionResult" style="background: rgba(139, 92, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;">
            <p style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 5px;">Converted Amount</p>
            <p id="resultAmount" style="color: #f0f9ff; font-size: 1.4rem; font-weight: 700;">-</p>
        </div>

        <div style="display: flex; gap: 10px;">
            <button id="convertBtn" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #8b5cf6, #ec4899); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                Convert
            </button>
            <button id="closeModal" style="flex: 1; padding: 12px; background: rgba(255, 255, 255, 0.1); color: #e2e8f0; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; font-weight: 600; cursor: pointer;">
                Close
            </button>
        </div>
    </div>
</div>

<!-- Responsive CSS -->
<style>
    @media (max-width: 768px) {
        .program-header {
            padding: 40px 15px !important;
        }

        .program-header h1 {
            font-size: 1.8rem !important;
        }

        [style*="grid-template-columns: 1fr 1fr"] {
            grid-template-columns: 1fr !important;
        }

        .currency-converter {
            width: 100% !important;
        }
    }

    @media (max-width: 480px) {
        .program-header {
            padding: 30px 15px !important;
        }

        .program-header h1 {
            font-size: 1.4rem !important;
        }

        .info-card {
            padding: 20px !important;
        }

        #currencyModal > div {
            width: 95% !important;
            padding: 25px !important;
        }
    }
</style>

<script>
    // Currency converter
    const converterBtns = document.querySelectorAll('.currency-converter');
    const modal = document.getElementById('currencyModal');
    const closeBtn = document.getElementById('closeModal');
    let currentAmount = 0;
    let currentCurrency = 'USD';

    converterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            currentAmount = parseFloat(this.dataset.amount);
            currentCurrency = this.dataset.currency;
            document.getElementById('fromCurrency').value = currentCurrency;
            modal.style.display = 'flex';
        });
    });

    closeBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });

    document.getElementById('convertBtn').addEventListener('click', async () => {
        const from = document.getElementById('fromCurrency').value;
        const to = document.getElementById('toCurrency').value;

        try {
            const response = await fetch('/residencies/api/currencies/convert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    amount: currentAmount,
                    from_currency: from,
                    to_currency: to
                })
            });

            const data = await response.json();
            if (data.status === 'success') {
                const converted = data.data.converted_amount;
                document.getElementById('resultAmount').textContent = 
                    `${to} ${converted.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
                document.getElementById('conversionResult').style.display = 'block';
            }
        } catch (error) {
            console.error('Conversion error:', error);
        }
    });

    // Close modal on background click
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });
</script>
{% endblock %}
